trigger:
  - main

pool:
  vmImage: 'ubuntu-latest'   # Uses Microsoft-hosted agent

variables:
  imageName: myapp
  dockerfilePath: Dockerfile
  tag: $(Build.BuildId)

steps:
  # Step 1: Checkout code (automatically done by default, but explicit is OK)
  - checkout: self

  # Step 2: Build and push Docker image
  - task: Docker@2
    displayName: 'Build and Push Docker Image to ACR'
    inputs:
      containerRegistry: myapp_register_connection   # <-- Service connection name
      repository: $(imageName)
      command: buildAndPush
      Dockerfile: $(dockerfilePath)
      tags: |
        $(tag)
        latest
